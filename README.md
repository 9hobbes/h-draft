# h-draft

<i>현재 개발 초기 단계입니다. 받아서 사용하기에 부적당합니다. 당분간 이 문서에서 제품 명세를 관리합니다.</i>

## 개요

이 문서는 **H Draft** 앱의 기본 개념과 요구사항을 기술하고, 이를 바탕으로 전반적인 아키텍처와 몇 가지 설계 모델을 제공한다.

## 용어와 주요 개념

### H Draft
(주)다음과 부산대학교 인공지능연구실/(주)나라인포테크의 맞춤법 서비스를 이용한 [일렉트론](https://github.com/electron/electron), 및 [Draft.js](https://github.com/facebook/draft-js) 기반의 텍스트 편집기이다.

### 철자 교정
일반적인 철자 교정은 의심되는 (하나의) 단어가 발견되면, 이와 '수학적 거리'가 짧은 올바른 단어를 제시하는 방식을 따른다. 영어 등의 굴절어에서는 별문제가 없지만, 교착어인 한국어는 형태소 분석 단계에서 오탐이 발생할 가능성이 크다. 그래서 **H Draft**는 사용자가 교정한 문자열을 리버스 인덱스에 저장한 뒤, 이 단어가 또 발견되면 교정하는 단순한 방식으로 작동한다.

이 방법의 장단점은 다음과 같다.
* 기존의 철자 교정은 제대로 된 단어만 관리하면서 의심되는 단어를 교정하지만, **H Draft**는 교정될 때마다 잘못된 단어를 인덱스에 추가해야 한다. 예컨대, 기존의 방식은 '프로세스'라는 단어만 관리한다면, **H Draft**는 '프로세스 에서', '플로세스를', '프로서스가' 등을 모두 누적해야 한다. 
* 기존의 철자 교정은 복수 단어, 가령 "산책 햇다"를 "산책했다"로 교정할 수 없으나 **H Draft**는 가능하다.
* **H Draft**는 처음부터 인덱스를 가지고 있지 않다. 사용자가 맞춤법 검사 기능을 호출하면 (주)다음과 부산대학교 인공지능연구실/(주)나라인포테크의 맞춤법 서비스를 이용해서 교정한 다음, 그 결과를 인덱스에 누적한다. 이렇게 저장된 정보는 오탐의 가능성이 희박한 만큼 맞춤법 검사 기능 호출 없이 자동으로 적용된다.
* 형태소 분석이 없고 단어 경계를 인지하는 검색을 하는 만큼 전역 교정을 할 수 있다.

### H Draft 컴포넌트

Draft.js 기반의 웹 컴포넌트로서 Draft.js의 기본 기능에 더해 '철자 교정 API'를 제공한다.

### 철자 교정 API (개발자용)
웹 브라우저의 textarea 컴포넌트, Draft.js 등 대부분의 웹 컴포넌트는 OS가 제공하는 철자 교정 기능을 이용해서 철자가 틀린 단어별로 밑줄을 긋고 대치어로 교체하는 인터페이스를 제공한다. **H Draft 컴포넌트**는 이와 유사하게 입력된 문장에서 원하는 패턴의 문자 열에 밑줄을 긋고 대치어와 정보를 제공한다. 기본 컴포넌트의 철자 교정 UI와의 차이점은 다음과 같다.
* 자동으로 작동하지 않는다. 문자열 패턴 등을 파라미터로, 명시적으로 호출해서 작동한다.
* 별도의 데이터베이스를 지정할 수 있다.
* 하나의 단어가 아닌, 원하는 패턴의 문자열을 지정할 수 있다.
* 대치어뿐 아니라 관련 정보 또한 제공한다.

그래서 VS Code의 lint 플러그인과 비슷하다.

### 철자 교정 인덱스
(주)다음과 부산대학교 인공지능연구실/(주)나라인포테크의 맞춤법 서비스를 이용해서 교정하거나 무시한 문자열은 내부 데이터베이스에서 관리된다. `수동으로 교정하기` 메뉴를 선택함으로써 철자 교정 인덱스를 편집할 수도 있다.

## 사용자 시나리오와 내부 동작

일반적인 사용 예는 아래과 같다. 

1. 앱을 실행하여 문장을 편집한다. 최초 사용자라면 자동으로 빨간색 밑줄이 생기지 않으나, 과거에 고친 단어를 또 실수했다면 자동으로 교정되고 파란색 밑줄이 생긴다.
1. 파란색 밑줄이 그어진 단어에 마우스 오른쪽 버튼을 누르면 `되돌리기`, `무시하기`, `{원 단어} 의심 단어에서 제외하기` 메뉴가 뜬다.
1. `되돌리기` 메뉴를 선택하면 원 단어로 되돌리고 빨간색 밑줄이 생긴다.
1. `무시하기` 메뉴를 선택하면 밑줄이 노란색으로 변한다.
1. `{원 단어} 의심 단어에서 제외하기` 메뉴를 선택하면 원 단어로 되돌리고 밑줄도 없어진다. '무시'된 단어는 데이터베이스에서 관리되지 않지만, '제외'된 단어는 관리되며, 별도의 UI를 통해 편집할 수 있다.
1. 맞춤법 교정 버튼을 누르면 (주)다음과 부산대학교 인공지능연구실/(주)나라인포테크의 맞춤법 서비스를 이용해서 의심되는 문자열에 빨간색 밑줄을 긋는다. 내부 인덱스에도 추가된다. 추가된 단어는 1단계의 자동 교정에 이용된다.
1. 빨간색 밑줄이 그어진 단어에 마우스 오른쪽 버튼을 누르면 `추천 단어 리스트`, `의심 단어에서 제외하기` 메뉴와 함께 `교정 정보` 팝업이 뜬다. 
1. `추천 단어 리스트`에서 하나를 선택하면 문장이 교정된다.
1. '편집 상태'와 '교정 상태'의 구분이 없으므로 이 상태에서 밑줄이 그인 단어도 편집할 수 있다. 단, 1단계와는 달리 빨간색 밑줄이 그어진 단어가 존재한다.
1. 'OS 기본 철자 교정 상태'가 존재한다. 이 경우, Draft.js의 철자 교정 기능을 사용한다.

## 기능 명세
### 텍스트 편집
Draft.js의 리치 텍스트 편집, 찾기, 바꾸기 등을 모두 지원한다.

### 파일 관리
파일 저장, 열기 등을 지원한다. 버전 관리, 버전 간 차이점 보기 기능은 작가를 위한 편집기라면 필요하지 않을까?

### 자동 교정
철자 교정 인덱스에 추가된 단어는 자동으로 교정된다. 물론 단어 경계가 맞아야 한다. 즉 '안넝'이라는 단어만 추가되면 '안넝 헬로'는 '안녕 헬로'로 교정되지만 '안넝하세요'는 자동으로 교정되지 않는다.

### 인덱스 관리

## 설계

### H Draft 컴포넌트

문자열의 밑줄은, 대상 문자열을 HTML 링크를 변경하고 밑줄 색깔에 맞는 스타일을 지정하는 방식으로 처리한다. `링크 왼쪽 마우스 클릭 핸들러`는 추천 단어와 설명을 보여주며, `추천 단어 클릭 핸들러`는 문장을 수정하여 링크의 종류(즉 색깔)를 바꾸고 내부 인덱스를 수정한다.