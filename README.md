# h-draft

<i>현재 개발 초기 단계입니다. 받아서 사용하기에 부적당합니다. 당분간 이 
문서에서 제품 명세를 관리합니다.</i>

## 개요

이 문서는 **H Draft** 앱의 기본 개념과 요구사항을 기술하고, 이를 바탕으로 
전반적인 아키텍처와 몇 가지 설계 모델을 제공한다.

## 용어와 주요 개념

### 맞춤법 교정 웹 서비스
(주)다음과 부산대학교 인공지능연구실/(주)나라인포테크에서 각각 제공하는 웹 
기반의 맞춤법 교정 서비스를 지칭한다.

### H Draft
**맞춤법 교정 웹 서비스**를 이용한 
[일렉트론](https://github.com/electron/electron), 및 
[Draft.js](https://github.com/facebook/draft-js) 기반의 텍스트 편집기이다.

### 맞춤법 교정
일반적으로 맞춤법 교정은 의심되는 (하나의) 단어가 발견되면, 별도로 관리되는 
올바른 단어 중에서 이와 '수학적 거리'가 짧은 단어를 찾아 제시하는 방식을 
따른다. 영어 등의 굴절어에서는 별문제가 없지만, 교착어인 한국어는 형태소 분석 
단계에서 오탐이 발생할 가능성이 크다. 그래서 **H Draft**는 사용자가 교정한 
문자열을 인덱스에 저장한 뒤, 이 단어가 또 발견되면 교정하는 원시적인 
방식으로 작동한다.

이 방법의 장단점은 다음과 같다.
* 기존의 맞춤법 교정은 제대로 된 단어만 관리하면서 의심되는 단어를 교정하지만, 
**H Draft**는 교정될 때마다 잘못된 단어를 인덱스에 추가한다. 예컨대, 
기존의 방식은 '프로세스'라는 단어만 관리한다면, **H Draft**는 '프로세스 에서', 
'플로세스를', '프로서스가' 등을 모두 누적해야 한다. 
* 기존의 방식과 달리 **H Draft**는 단어 경계가 맞아야만 교정한다. 예컨대, 
'햇다'가 인덱스에 있다고 해서 '햇다면'을 교정하지 않는다.
* 기존의 맞춤법 교정은 복수 단어, 가령 "산책 햇다"를 "산책했다"로 교정할 수 
없으나 **H Draft**는 가능하다.
* **H Draft**는 처음부터 인덱스를 가지고 있지 않다. 사용자가 **맞춤법 교정 
웹 서비스**를 명시적으로 호출하여 교정한 다음, 그 결과를 인덱스에 저장한다. 
이렇게 누적된 정보는 형태소 분석이 없고 단어 경계가 맞아야 활용되는 만큼, 
오탐의 가능성이 희박하여 명시적인 호출 없이 자동으로 적용된다.
* 역시 같은 이유로 해당 단어에 한하지 않고 전역 교정을 할 수 있다.

### H Draft 컴포넌트

Draft.js 기반의 웹 컴포넌트로서 Draft.js의 기본 기능에 더해 
**맞춤법 교정 API**를 제공한다. **H Draft**의 대부분의 기능을 담당한다.

### 맞춤법 교정 API
웹 브라우저의 textarea 컴포넌트, Draft.js 등 대부분의 웹 컴포넌트는 OS가 
제공하는 맞춤법 교정 기능을 이용해서 맞춤법이 틀린 단어에 점선을 긋고 
대치어로 교체하는 인터페이스를 제공한다. **H Draft 컴포넌트**는 이와 유사하게 
입력된 문장에서 원하는 패턴의 문자열에 점선을 긋고 원하는 대치어와 정보를 
표현할 수 있는 맞춤법 교정 API를 제공한다. 단, 직접 **맞춤법 교정 웹 
서비스**를 호출하지는 않는다.

웹 브라우저의 기본 컴포넌트와 차이점은 다음과 같다.
* 자동으로 작동하지 않는다. 문자열 패턴 등을 파라미터로, 명시적으로 호출해서 
작동한다.
* 별도의 데이터베이스를 지정할 수 있다.
* 하나의 단어가 아닌, 원하는 패턴의 문자열을 지정할 수 있다.
* 대치어뿐 아니라 관련 정보 또한 제공한다.

그래서 VS Code의 lint 플러그인과 비슷하다.

### 맞춤법 교정 인덱스
맞춤법 교정 웹 서비스를 이용해서 교정하거나 제외된 문자열은 내부 
데이터베이스에서 관리된다. `직접 교정하기` 메뉴를 선택함으로써 웹 서비스를
거치지 않고 맞춤법 교정 인덱스를 편집할 수도 있다.

## 사용자 시나리오와 내부 동작

일반적인 사용 예는 아래와 같다. 

1. 앱을 실행하여 문장을 편집한다. 최초 사용자라면 맞춤법 교정을 제안하는 점선이
생기지 않으나, 과거에 고친 단어를 또 실수했다면 자동으로 교정되고 회색 
점선이 생긴다.
1. 회색 점선이 그어진 단어에 마우스 오른쪽 버튼을 누르면 `되돌리기`, 
`무시하기`, `'원 단어' 의심 단어에서 제외하기` 메뉴가 뜬다.
1. `되돌리기` 메뉴를 선택하면 원 단어로 되돌리고 빨간색 점선이 생긴다.
1. `무시하기` 메뉴를 선택하면 점선의 색깔이 노란색으로 변한다.
1. `'원 단어' 의심 단어에서 제외하기` 메뉴를 선택하면 원 단어로 되돌리고 
점선도 없어진다. '무시'된 단어는 데이터베이스에서 관리되지 않지만, '제외'된 
단어는 관리되며, `직접 교정하기` 메뉴를 이용해서 편집할 수 있다.
1. 맞춤법 교정 버튼을 누르면 맞춤법 교정 웹 서비스를 이용해서 의심되는 
문자열에 빨간색 점선을 긋고 내부 인덱스에 추가한다. 추가된 단어는 자동 교정에 
이용된다.
1. 빨간색 점선이 그어진 단어에 마우스 오른쪽 버튼을 누르면 `추천 단어` 리스트, 
`의심 단어에서 제외하기` 메뉴와 함께 `교정 정보` 팝업이 뜬다. 
1. `추천 단어 리스트`에서 하나를 선택하면 문장이 교정된다.
1. '편집 상태'와 '교정 상태'의 구분이 없으므로 점선이 그인 단어도 편집할 수 
있다. 단, 1단계와는 달리 빨간색 점선이 그어진 단어가 존재한다.
1. 'OS 기본 맞춤법 교정 상태'가 존재한다. Draft.js의 맞춤법 교정 
기능을 활성화해서 보여준다. 이 경우, 점선은 그어지지만, 추천 단어를 제시할 수 
없는 때도 있으므로 일부 메뉴 아이템만 활성화된다.

## 기능 명세
### 텍스트 편집
Draft.js의 리치 텍스트 편집, 찾기, 바꾸기 등을 모두 지원한다.

문자열에 대한 입력/수정/삭제 시 어떤 기능이 호출되고 어떤 기능이 호출 가능해
지는지 이곳에 정리한다.

### 파일 관리
파일 저장, 열기 등을 지원한다. 버전 관리, 버전 간 차이점 보기 기능은 작가를 
위한 편집기라면 필요하지 않을까?

### 자동 교정
맞춤법 교정 인덱스에 추가된 단어는 자동으로 교정된다. 물론 단어 경계가 맞아야 
한다.

### 웹 서비스를 이용한 맞춤법 교정

### 빨간색 점선이 그어진 단어의 컨텍스트 메뉴

### 회색 점선이 그어진 단어의 컨텍스트 메뉴

### 노란색 점선이 그어진 단어의 컨텍스트 메뉴


## 주요 개발 단위
### 기초적인 리액트 개발 방법
### 기초적인 Draft.js 사용법
### 기초적인 일렉트론 개발 방법
### H Draft 컴포넌트
#### 컨텍스트 메뉴
#### 정보를 포함한 컨텍스트 메뉴
#### 텍스트에 밑줄 넣어주는 기능
### 인덱스 관리 모듈
#### 적합한 데이터 베이스 선택
별도의 프로세스가 필요한지, 자바 스크립트 인터페이스가 좋은지가 관건.
#### 주어진 문장에서 인덱스에서 발견된 문자열을 표시하는 기능

## 마일스톤

## 설계

**H Draft**는 'H Draft 컴포넌트', 
['hanspell'](https://github.com/9beach/hanspell) 기반으로 맞춤법 검사 웹 
서비스를 호출하는 Node.js 모듈(한스펠 모듈), 파일을 열고 저장하는 
Node.js 모듈(파일 관리 모듈), 인덱스 관리 모듈로 구성된다. 

참조 관계는 다음과 같다.
* 파일 관리 모듈이 H Draft 컴포넌트 참조.
* 인덱스 관리 모듈이 H Draft 컴포넌트 참조.
* 한스펠 모듈이 H Draft 컴포넌트 참조.

H Draft 컴포넌트는 웹 컴포넌트이며, 인덱스 관리 모듈은 자바스크립트 
인터페이스를 지원하는 바이너리를 Node.js로 감싼 모듈이며, 나머지는 
모두 Node.js 모듈이다.

### H Draft 컴포넌트

문자열 밑의 점선은, 대상 문자열을 HTML 링크를 변경하고 점선 색깔에 맞는 
스타일을 지정하는 방식으로 처리한다. `링크 왼쪽 마우스 클릭 핸들러`는 추천 
단어와 설명을 보여주며, `추천 단어 클릭 핸들러`는 문장을 수정하여 링크의 
종류(즉 색깔)를 바꾸고 내부 인덱스를 수정한다.

### 파일 관리 모듈

### 한스펠 모듈

### 인덱스 관리 모듈
